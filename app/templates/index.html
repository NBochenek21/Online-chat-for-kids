<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Asystent dla dzieci üß∏</title>
  <style>
    /* ========== GLOBAL ========== */
    body {
      font-family: 'Comic Sans MS', cursive, sans-serif;
      margin: 0;
      overflow: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(to bottom, #aee1f9 0%, #fff9c4 100%);
      position: relative;
    }

    h1 {
      color: #6a1b9a;
      text-shadow: 2px 2px 3px #fff;
      margin-bottom: 20px;
      font-size: 2.5em;
    }

    /* ========== BACKGROUND DECORATIONS ========== */
    .background {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      overflow: hidden;
      z-index: -1;
    }

    /* Clouds */
    .cloud {
      position: absolute;
      background: white;
      border-radius: 50%;
      opacity: 0.9;
      animation: moveCloud 70s linear infinite;
    }
    @keyframes moveCloud {
      from { left: -200px; }
      to { left: 110%; }
    }
    .cloud.small { width: 60px; height: 40px; top: 80px; animation-duration: 50s; }
    .cloud.medium { width: 120px; height: 70px; top: 130px; animation-duration: 70s; }
    .cloud.large { width: 180px; height: 100px; top: 50px; animation-duration: 90s; }

    /* Butterflies */
    .butterfly {
      position: absolute;
      width: 30px;
      height: 25px;
      background: pink;
      border-radius: 50%;
      animation: flyButterfly 10s linear infinite;
    }
    .butterfly::before, .butterfly::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 25px;
      background: #ff80ab;
      border-radius: 50%;
      transform-origin: center;
      animation: flapWings 0.4s infinite ease-in-out;
    }
    .butterfly::before { left: -20px; }
    .butterfly::after { right: -20px; }

    @keyframes flapWings {
      0%, 100% { transform: rotate(15deg); }
      50% { transform: rotate(-15deg); }
    }
    @keyframes flyButterfly {
      0% { left: -50px; top: 60%; }
      50% { top: 40%; }
      100% { left: 110%; top: 60%; }
    }

    /* Floating hearts */
    .heart {
      position: absolute;
      bottom: -50px;
      width: 20px;
      height: 20px;
      background: red;
      transform: rotate(45deg);
      animation: floatHeart 10s linear infinite;
    }
    .heart::before, .heart::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      background: red;
      border-radius: 50%;
    }
    .heart::before { top: -10px; left: 0; }
    .heart::after { left: -10px; top: 0; }
    @keyframes floatHeart {
      0% { opacity: 0; transform: translateY(0) scale(0.8) rotate(45deg); }
      20% { opacity: 1; }
      100% { opacity: 0; transform: translateY(-700px) scale(1.5) rotate(45deg); }
    }

    /* Rolling balls */
    .ball {
      position: absolute;
      bottom: 0;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      animation: rollBall 15s linear infinite;
    }
    @keyframes rollBall {
      0% { left: -50px; transform: rotate(0deg); }
      100% { left: 110%; transform: rotate(720deg); }
    }

    /* Flowers */
    .flower {
      position: absolute;
      bottom: 10px;
      width: 25px;
      height: 25px;
      background: pink;
      border-radius: 50%;
      animation: sway 4s ease-in-out infinite;
    }
    .flower::before {
      content: '';
      position: absolute;
      width: 10px;
      height: 10px;
      background: yellow;
      border-radius: 50%;
      top: 7px;
      left: 7px;
    }
    @keyframes sway {
      0%, 100% { transform: rotate(0deg); }
      50% { transform: rotate(5deg); }
    }

    /* ========== BEAR ========== */
    .window {
      background: rgba(255, 255, 255, 0.85);
      border: 5px solid #f48fb1;
      border-radius: 40px;
      box-shadow: 0 0 30px rgba(0,0,0,0.15);
      width: 380px;
      height: 460px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 25px;
      position: relative;
    }

    #bearContainer {
      position: relative;
      width: 220px;
      height: 280px;
      animation: float 5s ease-in-out infinite;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .ear {
      position: absolute;
      width: 70px;
      height: 70px;
      background: #d7ccc8;
      border-radius: 50%;
      top: 0;
    }
    .ear::after {
      content: '';
      position: absolute;
      width: 45px;
      height: 45px;
      background: #ffe0b2;
      border-radius: 50%;
      top: 12px;
      left: 12px;
    }
    .ear.left { left: 10px; }
    .ear.right { right: 10px; }

    .head {
      position: absolute;
      width: 144px;
      height: 144px;
      background: #bcaaa4;
      border-radius: 50%;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
    }

    .eye {
      position: absolute;
      width: 30px;
      height: 30px;
      background: white;
      border-radius: 50%;
      top: 55px;
    }
    .eye.left { left: 35px; }
    .eye.right { right: 35px; }

    .pupil {
      position: absolute;
      width: 12px;
      height: 12px;
      background: black;
      border-radius: 50%;
      top: 9px;
      left: 9px;
      animation: blink 4s infinite;
    }
    @keyframes blink {
      0%, 90%, 100% { transform: scaleY(1); }
      95% { transform: scaleY(0.1); }
    }

    .nose {
      position: absolute;
      width: 34px;
      height: 22px;
      background: #5d4037;
      border-radius: 50% 50% 60% 60%;
      top: 90px;
      left: 50%;
      transform: translateX(-50%);
    }

    .mouth {
      position: absolute;
      width: 40px;
      height: 7px;
      border-bottom: 5px solid #6d4c41;
      border-radius: 0 0 40px 40px;
      top: 120px;
      left: 50%;
      transform: translateX(-50%);
      background: #f48fb1;
      animation: talk 3s infinite ease-in-out;
    }
    @keyframes talk {
      0%, 100% { transform: translateX(-50%) scaleY(1); }
      50% { transform: translateX(-50%) scaleY(1.5); }
    }

    .body {
      position: absolute;
      width: 145px;
      height: 145px;
      background: #bcaaa4;
      border-radius: 50%;
      top: 160px;
      left: 50%;
      transform: translateX(-50%);
    }

    .belly {
      position: absolute;
      width: 80px;
      height: 80px;
      background: #ffe0b2;
      border-radius: 50%;
      top: 200px;
      left: 50%;
      transform: translateX(-50%);
    }

    /* Arms & Legs */
    .arm, .leg {
      position: absolute;
      background: #bcaaa4;
      border-radius: 50%;
    }
    .arm {
      width: 50px;
      height: 80px;
      top: 180px;
      animation: wave 3s infinite ease-in-out;
    }
    .arm.left {
      left: 0;
      transform-origin: top right;
    }
    .arm.right {
      right: 0;
      transform-origin: top left;
    }
    @keyframes wave {
      0%, 100% { transform: rotate(0deg); }
      50% { transform: rotate(10deg); }
    }

    .leg {
      width: 60px;
      height: 90px;
      bottom: 0;
      top: 280px;
      animation: bounce 4s infinite ease-in-out;
    }
    .leg.left { left: 40px; }
    .leg.right { right: 40px; }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(8px); }
    }

    /* Button */
    button {
      padding: 14px 30px;
      font-size: 1.1em;
      border: none;
      border-radius: 20px;
      background-color: #f06292;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.1s;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    button:hover { background-color: #ec407a; transform: scale(1.05); }
    button:active { background-color: #e91e63; transform: scale(0.97); }
  </style>
</head>

<body>
  <h1>Asystent dla dzieci üß∏</h1>

  <div class="background">
    <div class="cloud small"></div>
    <div class="cloud medium"></div>
    <div class="cloud large"></div>

    <div class="butterfly" style="animation-delay: 0s;"></div>
    <div class="butterfly" style="animation-delay: 3s; top: 50%;"></div>
    <div class="butterfly" style="animation-delay: 6s; top: 30%;"></div>

    <div class="heart" style="left: 10%; animation-delay: 0s;"></div>
    <div class="heart" style="left: 30%; animation-delay: 3s;"></div>
    <div class="heart" style="left: 60%; animation-delay: 5s;"></div>
    <div class="heart" style="left: 80%; animation-delay: 7s;"></div>

    <div class="ball" style="background: #ffb74d;"></div>
    <div class="ball" style="background: #81d4fa; animation-delay: 5s;"></div>

    <div class="flower" style="left: 10%;"></div>
    <div class="flower" style="left: 25%;"></div>
    <div class="flower" style="left: 45%;"></div>
    <div class="flower" style="left: 65%;"></div>
    <div class="flower" style="left: 85%;"></div>
  </div>

  <div class="window">
    <div id="bearContainer">
      <div class="ear left"></div>
      <div class="ear right"></div>
      <div class="head">
        <div class="eye left"><div class="pupil"></div></div>
        <div class="eye right"><div class="pupil"></div></div>
        <div class="nose"></div>
        <div class="mouth"></div>
      </div>
      <div class="body"></div>
      <div class="belly"></div>
      <div class="arm left"></div>
      <div class="arm right"></div>
      <div class="leg left"></div>
      <div class="leg right"></div>
    </div>
  </div>

  <button id="recordBtn">üé§ Nagraj pytanie</button>

  <script>
const button = document.getElementById('recordBtn');
    const mouth = document.querySelector('.mouth');
    let recording = false;
    let mediaRecorder;
    let audioChunks = [];

    async function startRecording() {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream, { mimeType: 'audio/webm' });

      audioChunks = [];
      mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
      mediaRecorder.start();
    }

    function stopRecording() {
      return new Promise(resolve => {
        mediaRecorder.onstop = async () => {
          const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
          resolve(audioBlob);
        };
        mediaRecorder.stop();
      });
    }

    async function sendAudio(audioBlob) {
      const formData = new FormData();
      formData.append('file', audioBlob, 'question.webm');

      const response = await fetch('/upload', {
        method: 'POST',
        body: formData
      });

      if (!response.ok) {
        alert('B≈ÇƒÖd przy wysy≈Çaniu pliku');
        return;
      }

      const arrayBuffer = await response.arrayBuffer();
      const audioUrl = URL.createObjectURL(new Blob([arrayBuffer], { type: 'audio/mp3' }));
      const audio = new Audio(audioUrl);
      audio.play();
    }

    button.addEventListener('click', async () => {
      recording = !recording;

      if (recording) {
        button.textContent = '‚èπÔ∏è Zatrzymaj nagrywanie';
        mouth.style.animation = 'talk 0.3s infinite ease-in-out';
        await startRecording();
      } else {
        button.textContent = 'üé§ Nagraj pytanie';
        mouth.style.animation = 'talk 3s infinite ease-in-out';
        const audioBlob = await stopRecording();
        await sendAudio(audioBlob);
      }
    });
  </script>
</body>
</html>   